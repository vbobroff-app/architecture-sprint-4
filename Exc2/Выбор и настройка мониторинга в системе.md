#### Мотивация 
В систему нужно добавить мониторинг, наблюдаемость способствует оптимизации процессов и сокращению количества ошибок. 


- Улучшение видимости и повышение безопасности системы. 
- Более быстрое решение проблем и повышение надёжности системы. 
- Повышение быстродействия системы и распределение ресурсов. 
- Ускорение рабочего процесса и DevOps.
- Ценные бизнес-инсайты. 
- Повышение удовлетворённости пользователей.

Своевременное решение проблем, которые связаны с производительностью и функциональностью приложения, улучшает пользовательский опыт.

#### Выбор подхода к мониторингу

Метод RED, который сфокусирован на трёх показателях: на частоте запросов, длительности их обработки и ошибках. Эти показатели помогают обеспечить стабильную работу веб-сервисов и API.

#### Метрики для отслеживанию с сервисами, где устанавливать

1. Number of dead-letter-exchange letters in RabbitMQ - количество 'умерших' сообщений при отказе в обработке. Установить в сервисе Messages Queue.
2. Number of message in flight in RabbitMQ - количество сообщений в потоке. Установить в сервисе Messages Queue.
3. Number of requests (RPS) for internet shop API
4. Number of requests (RPS) for CRM API - количество запросов в секунду для for CRM API
5. Number of requests (RPS) for MES API - количество запросов в секунду для MES API
6. Number of requests (RPS) per user for internet shop API - 
количество запросов в секунду для ShopAPI
7. Number of requests (RPS) per user for CRM API - количество запросов в секунду для CRM API
8. Number of requests (RPS) per user for MES API - количество запросов в секунду для MES API
9. CPU % for shop API - загрузка ЦП ShopAPI
10. CPU % for CRM API - загрузка ЦП CRM API
11. CPU % for MES API - загрузка ЦП MES API
12. Memory Utilisation for shop API - интенсивность работы с памятью  shop API
13. Memory Utilisation for CRM API - интенсивность работы с памятью CRM API 
14. Memory Utilisation for MES API - интенсивность работы с памятью MES API
15. Memory Utilisation for shop db instance - интенсивность работы с памятью для экземпляра БД 
16. Memory Utilisation for MES db instance - интенсивность работы с памятью 
17. Number of connections for shop db instance - определяет число одновременных подключений к экземпляру БД
18. Number of connections for MES db instance- определяет число одновременных подключений к экземпляру БД
19. Response time (latency) for shop API - время ответа (латентность), мера времени задержки запросов shop API
20. Response time (latency) for CRM API - время ответа (латентность), мера времени задержки запросов CRM API
21. Response time (latency) for MES API - время ответа (латентность), мера времени задержки запросов MES API
22. Size of S3 storage - размер файлового хранилища
23. Size of shop db instance - размер для экземпляра Shop DB 
24. Size of MES db instance - размер для экземпляра MES DB
25. Number of HTTP 200 for shop API - количесво успешных запросов Shop API
26. Number of HTTP 200 for CRM API - количесво успешных запросов CRM API 
27. Number of HTTP 200 for MES API - количесво успешных запросов MES API
28. Number of HTTP 500 for shop API - количество ошибочных откликов Shop API
29. Number of HTTP 500 for CRM API - количество ошибочных откликов CRM API
30. Number of HTTP 500 for MES API - количество ошибочных откликов MES API
31. Number of HTTP 500 for shop API - количество ошибочных откликов Shop API 

Ярлыки позволяют добавить детали — для скорости загрузки процессора - скорость конкретного ядра по определённому IP-адресу.

Метки method="GET" + status="200", + status="500" позволят сделать метрики более гибкими.


#### План действий

Стек технологий для сбора метрик Prometheus + Grafana + Redis.

- Prometheus используется для мониторинга, сбора метрик из различных сервисов и приложений и оповещения — алёртинга. Он позволяет отслеживать работу системы в реальном времени, выявлять проблемы и получать уведомления о возможных сбоях.
- Grafana — это инструмент визуализации данных, который используется для создания дашбордов (панелей инструментов) с графиками, диаграммами.

Для сервисов необходимо реализовать:
- настроить инструмент Prometheus для сбора показателей,
- собрать RED-метрики для запросов сервиса и вызовов Redis,
- настроить Grafana для визуализации показателей Prometheus.

1. Реализовать docker-compose для Promteteus
2. Создаnm файл с конфигурацией prometheus.yml
3. Добавbnm блок настроек scrape в prometheus.yml приложение
4. В Prometheus в разделе Targets обнапужить новый сервис
5. Добавить Grafana в docker-compose
6. Открыть `http://localhost:3000 admin/admin`. Добавить Prometheus: Connections→ Add new connection → «Prometheus» в строке поиска
7. В настройках провисать ссылку на сервер с метриками http://prometheus:9090. Сохранить.
8. Добавить метрики, нажав Add visualization. Первой визуализировать Requests.
9. Заполнить название метрики http_request_duration_count и label = 500 (ошибочные запросы) и нажмать Run queries. Нарисуется график, далее исправить Title в Panel Options и нажмите Save. 
10. Аналогично настроить другие необходимые метрики RED по рекомендации инженера DevOps.
 